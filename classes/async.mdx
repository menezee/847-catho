import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { github, vsDark } from "@code-surfer/themes";

import { future } from '@mdx-deck/themes';
export const theme = future;

import { Block, Image } from './components';

<Block>
  <Block centralized>
    <Image
      src="https://i.ibb.co/9cFPyxm/js.png"
      height={300}
      width={300}
    />
  </Block>
  <h2>Programação Assíncrona</h2>
  <h3>callback, promise, async/await</h3>
</Block>

---

# Agenda
- Callbacks
- Promises
- Async/Await
- Parallel

---

<CodeSurfer>

```js title="Callbacks"
fs
  .readFile(
    filePath,
    'utf-8',
    callback,
  );
```

```js title="Callbacks"
fs
  .readFile(
    filePath,
    'utf-8',
    function(err, data) {

    },
  );
```

```js title="Callbacks"
fs
  .readFile(
    filePath,
    'utf-8',
    function(err, data) {
      if (err) {
        console.error(
          'error reading file: ',
          err.message,
        );
      }

      console.log(
        `data from ${filePath}:`,
        data,
      );
    },
  );
```

```js title="Promises"
const fsPromise = require('fs').promises;
```

```js title="Promises"
fsPromise
  .readFile(
    filePath,
    'utf-8',
  )
```

```js title="Promises"
fsPromise
  .readFile(
    filePath,
    'utf-8',
  )
  .then()
  .catch();
```

```js title="Promises"
fsPromise
  .readFile(
    filePath,
    'utf-8',
  )
  .then((content) => {
    console.log(
      'do something with the content'
    );
  })
  .catch();
```

```js title="Promises"
fsPromise
  .readFile(
    filePath,
    'utf-8',
  )
  .then((content) => {
    console.log(
      'do something with the content'
    );
  })
  .catch((err) => {
    console.error(
      'oops, something went wrong!',
      err.message
    );
  });
```

```js title="Promises"
function esperaXMinutos(minutos) {
  setTimeout(() => {
    return 'minutos esperados!';
  }, minutos);
}
```

```js title="Promises"
function esperaXMinutos(minutos) {
  return new Promise();
}
```

```js title="Promises"
function esperaXMinutos(minutos) {
  return new Promise(callback);
}
```

```js title="Promises"
function esperaXMinutos(minutos) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve('minutos esperados!');
    }, minutos);
  });
}
```

```js title="Promises"
esperaXMinutos
  .then(result => {
    console.log('resultado: ', result);
  });
```

```js title="Async/Await"
function fn() {
  return 42;
}
```

```js title="Async/Await"
async function fn() {
  return 42;
}
```

```js title="Async/Await"
Promise {<fulfilled>: 42}
```

```js title="Async/Await"
async function fn() {
  throw new Error(42);
}
```

```js title="Async/Await"
Promise {<rejected>: Error: 42
```

```js title="Async/Await"
fn()
  .then(response => {
    console.log(response);
  })
  .catch(err => {
    console.error(err.message);
  })
```

```js title="Async/Await"
function () {

}
```

```js title="Async/Await"
(function () {

})();
```

```js title="Async/Await"
(async function () {

})();
```

```js title="Async/Await"
(async function () {
  try {
    const res = await fn();
    console.log(`res is: ${res}`);
  } catch (err) {
    console.error(err.message);
  }
})();
```

```js title="Parallel"
const getNumberAsync =
  async () => {
    return Math.random();
  };
```

```js title="Parallel"
getNumberAsync()
  .then(number => {
    console.log(number);
  });
```

```js title="Parallel"
getNumberAsync()
  .then(number => {
    console.log(number);
  });
getNumberAsync()
  .then(number => {
    console.log(number);
  });
getNumberAsync()
  .then(number => {
    console.log(number);
  });
```

```js title="Parallel"
Promise.all();
```

```js title="Parallel"
const arrayOfPromises = [
  getNumberAsync(),
  getNumberAsync(),
  getNumberAsync(),
];
```

```js title="Parallel"
const arrayOfPromises = [
  getNumberAsync(),
  getNumberAsync(),
  getNumberAsync(),
];

Promise.all(arrayOfPromises)
```

```js title="Parallel"
Promise {<fulfilled>: Array(3)}
/*
[
  0.7637721472331209,
  0.5826775321865587,
  0.35652220897084375,
]
*/
```

```js title="Parallel"
Promise
    .all(arrayOfPromises)
    .then();
```

```js title="Parallel"
Promise
    .all(arrayOfPromises)
    .then(results => {
      results.forEach((result, idx) => {
        console.log(`result: ${idx}: ${result}`);
      });
    });
```

```js title="Parallel"
Promise.all;
Retorna array de promises quando todas resolverem
Rejeita imediatamente quando uma é rejeitada
```

```js title="Parallel"
Promise.allSettled;
Retorna array de promises quando todas resolverem
{status: "fulfilled", value: 33},
{status: "rejected",  reason: Error: an error}
```

```js title="Parallel"
Promise.any;
Retorna a promise que resolver antes
```

```js title="Parallel"
Promise.race
Retorna assim que alguma das promises resolver
ou rejeitar
```

</CodeSurfer>
